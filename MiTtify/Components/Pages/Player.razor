@page "/player"
@rendermode InteractiveServer
@using Microsoft.EntityFrameworkCore
@using MiTtify.DataBase
@inject IDbContextFactory<MiTtify.Data.MiTtifyContext> DbFactory

<h3>ðŸŽµ Scegli una canzone:</h3>

@if (Canzoni.Any())
{
    <select @onchange="OnSongSelected" class="form-select">
        <option value="">-- Seleziona una canzone --</option>
        @foreach (var song in Canzoni)
        {
            <option value="@song.FilePath">@song.Nome - @song.Autore</option>
        }
    </select>

    @if (!string.IsNullOrEmpty(SelectedSongPath))
    {
        <div class="mt-4">
            <audio controls autoplay>
                <source src="@SelectedSongPath" type="audio/mpeg">
                Il tuo browser non supporta il player audio.
            </audio>
        </div>
    }
}
else
{
    <p>Non ci sono canzoni caricate.</p>
}

@code {
    private List<Canzone> Canzoni = new();
    private string? SelectedSongPath;

    protected override async Task OnInitializedAsync()
    {
        using var context = DbFactory.CreateDbContext();
        Canzoni = await context.Canzone.ToListAsync();
    }

    private void OnSongSelected(ChangeEventArgs e)
    {
        SelectedSongPath = e.Value?.ToString();
    }
}