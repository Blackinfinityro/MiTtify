@using MiTtify.DataBase
@using MiTtify.Components.Shared
@inject IJSRuntime JSRuntime

@if (Songs?.Any() == true)
{
    <select @onchange="OnSongSelected" class="form-select">
        <option value="">-- Seleziona una canzone --</option>
        @foreach (var song in Songs)
        {
            <option value="@song.FilePath">@song.Nome - @song.Autore</option>
        }
    </select>

    @if (!string.IsNullOrEmpty(SelectedSongPath))
    {
        <div class="mt-4">
            <audio controls @ref="AudioReference">
                <source src="@SelectedSongPath" type="audio/mp3" />
                Il tuo browser non supporta il player audio.
            </audio>
        </div>
    }
}
else
{
    <p>Non ci sono canzoni da riprodurre.</p>
}

@code {
    [Parameter] public List<Canzone>? Songs { get; set; }
    ElementReference AudioReference;

    private string SelectedSongPath = null;

    private async Task OnSongSelected(ChangeEventArgs e)
    {
        SelectedSongPath = e.Value?.ToString();
        await JSRuntime.InvokeVoidAsync("playAudio", AudioReference, SelectedSongPath);
    }
}